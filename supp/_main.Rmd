--- 
title: "A Minimal Book Example"
author: "John Doe"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]
# url: your book url like https://bookdown.org/yihui/bookdown
# cover-image: path to the social sharing image like images/cover.jpg
description: |
  This is a minimal example of using the bookdown package to write a book.
  The HTML output format for this example is bookdown::gitbook,
  set in the _output.yml file.
link-citations: yes
github-repo: rstudio/bookdown-demo
---

# url: your book url like https://bookdown.org/yihui/bookdown

Placeholder


## Usage 
## Render book
## Preview book

<!--chapter:end:index.Rmd-->

# Hello bookdown 

All chapters start with a first-level heading followed by your chapter title, like the line above. There should be only one first-level heading (`#`) per .Rmd file.

## A section

All chapter sections start with a second-level (`##`) or higher heading followed by your section title, like the sections above and below here. You can have as many as you want within a chapter.

### An unnumbered section {-}

Chapters and sections are numbered by default. To un-number a heading, add a `{.unnumbered}` or the shorter `{-}` at the end of the heading, like in this section.

<!--chapter:end:01-intro.Rmd-->

# Stemmed arrow points

## Load packages + data

```{r load.packages, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# load packages
devtools::install_github("MomX/Momocs")
library(here)
library(Momocs)

# read images
jpg.list <- list.files("stemmed", 
                       full.names = TRUE)

# read attribute data
att.data <- read.csv("stemmed.csv", 
                     header = TRUE, 
                     as.is = TRUE)

# attribute to factor
att.data$burial <- as.factor(att.data$burial)
att.data$site <- as.factor(att.data$site)
```

## Generate outlines

```{r outlines + attributes, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# generate outlines
outlines <- jpg.list %>%
  import_jpg()

# add attributes
data.out <- Out(outlines, 
         fac = att.data)

# scale, align, rotate, and center specimens
norm.outlines <- data.out %>% 
  coo_scale() %>%
  coo_align() %>% 
  coo_center()
```

## Calibrate harmonic + EFA

```{r cal.harm, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# calibrate how many harmonics needed
calibrate_harmonicpower_efourier(norm.outlines, 
                                 nb.h = 30)

# generate efa outlines
efa.outlines <- efourier(norm.outlines, 
                         nb.h = 23,
                         norm = TRUE)

# use efa.outlines for pca
pca.outlines <- PCA(efa.outlines)
```

## PCA

```{r pca.plot, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# plot pca by trinomial
plot_PCA(pca.outlines, 
         morphospace_position = "xy",
         palette = pal_qual_solarized,
         chullfilled = TRUE,
         ~site,
         labelgroups = TRUE,
         legend = FALSE,
         axesnames = TRUE,
         morphospace = TRUE,
         eigen = TRUE,
         zoom = 0.85)

# plot pca by burial
plot_PCA(pca.outlines, 
         morphospace_position = "xy",
         palette = pal_qual_solarized,
         chullfilled = TRUE,
         ~burial,
         labelgroups = TRUE,
         legend = FALSE,
         axesnames = TRUE,
         morphospace = TRUE,
         eigen = TRUE,
         zoom = 0.85)

# mean shape + 2sd for the first 5 pcs
PCcontrib(pca.outlines, nax = 1:5)
```

## MANOVA

```{r manova, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# shape difference between sites?
MANOVA(pca.outlines, 'site')

# shape difference between burials?
MANOVA(pca.outlines, 'burial')

# which differ?
MANOVA_PW(pca.outlines, 'burial')
```

## Mean shapes

```{r ms1, out.width = "100%", dpi = 300, echo=TRUE, warning=FALSE}
# mean shapes by site
ms.1 <- MSHAPES(efa.outlines, ~site)
plot_MSHAPES(ms.1, size = 0.75)

# mean shapes by burial
ms.1 <- MSHAPES(efa.outlines, ~burial)
plot_MSHAPES(ms.1, size = 0.75)

## characterise shape diffs by significant results
# mean shapes for 41cp5/41hs15
ms.2 <- MSHAPES(efa.outlines, ~site, nb.pts = 100)$shp
Carpenter <- ms.2$Carpenter
PTM <- ms.2$PTM
par(mfrow=c(2,2))
tps_iso(Carpenter, PTM, iso.nb = 1000, grid = TRUE, legend = FALSE)
tps_arr(Carpenter, PTM, arr.nb = 200, grid = TRUE, legend = FALSE)
tps_grid(Carpenter, PTM, grid.size = 50)

# mean shapes for B19/B24
ms.3 <- MSHAPES(efa.outlines, ~burial, nb.pts = 100)$shp
B19 <- ms.3$B19
B24 <- ms.3$B24
par(mfrow=c(2,2))
tps_iso(B19, B24, iso.nb = 1000, grid = TRUE, legend = FALSE)
tps_arr(B19, B24, arr.nb = 200, grid = TRUE, legend = FALSE)
tps_grid(B19, B24, grid.size = 50)

# mean shapes for F2.2072/F2.2073
F2.2072 <- ms.3$F2.2072
F2.2073 <- ms.3$F2.2073
par(mfrow=c(2,2))
tps_iso(F2.2073, F2.2072, iso.nb = 1000, grid = TRUE, legend = FALSE)
tps_arr(F2.2073, F2.2072, arr.nb = 200, grid = TRUE, legend = FALSE)
tps_grid(F2.2073, F2.2072, grid.size = 50)

# mean shapes for F2.2073/F8.1091
F8.1091 <- ms.3$F8.1091
par(mfrow=c(2,2))
tps_iso(F2.2073, F8.1091, iso.nb = 1000, grid = TRUE, legend = FALSE)
tps_arr(F2.2073, F8.1091, arr.nb = 200, grid = TRUE, legend = FALSE)
tps_grid(F2.2073, F8.1091, grid.size = 50)
```

<!--chapter:end:04-burial.efa.Rmd-->

`r if (knitr::is_html_output()) '
# References {-}
'`

<!--chapter:end:07-references.Rmd-->

